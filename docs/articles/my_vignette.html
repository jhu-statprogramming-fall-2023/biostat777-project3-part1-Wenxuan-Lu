<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="htlgmm">
<title>Example Analysis • htlgmm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.7/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.7/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example Analysis">
<meta property="og:description" content="htlgmm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">htlgmm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/my_vignette.html">Example Analysis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example Analysis</h1>
            
      
      
      <div class="d-none name"><code>my_vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The National Football League (NFL) is not just a sport. It’s part of
the American culture that attracts the attention of the million across
the nation. In this analysis, I am going to explore the factors that can
influence the weekly attendance and use the lasso regression to predict
the weekly attendance. The aiming questions are</p>
<ol style="list-style-type: decimal">
<li>Is the home field advantage real?</li>
<li>If the home field advantage is real, does the number of attendants
increase when it is a home game?</li>
<li>Can we predict the weekly attendance from basic information about
both teams?</li>
</ol>
<p>In addition to this, I will explore in question 3 about how to build
the model when our access to data is restricted, and show the usage of
the data integration method in package <code>htlgmm</code>.</p>
</div>
<div class="section level2">
<h2 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h2>
<p>The data set is obtained from package <code>tidytuesday</code> from
week <a href="https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-02-04" class="external-link">2020-02-04</a>.
It is originated from Pro Football Reference <a href="https://www.pro-football-reference.com/years/2019/index.htm" class="external-link">team
standings</a>. The data set contains the weekly attendance information
for games from 2000 to 2019. It also provides information about each
game and the rating of the teams. Please refer to the <a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-02-04/readme.md#data-dictionary" class="external-link">data
dictionary</a> for more details.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">htlgmm</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/thebioengineer/tidytuesdayR" class="external-link">tidytuesdayR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glmnet.stanford.edu" class="external-link">glmnet</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a data folder if needed</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"../data"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"../data"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># download data from tidytuesday and save it if needed</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"../data/attendance.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">attendance</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-04/attendance.csv'</span><span class="op">)</span></span>
<span>    <span class="va">standings</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-04/standings.csv'</span><span class="op">)</span></span>
<span>    <span class="va">games</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-04/games.csv'</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">attendance</span>, <span class="st">"../data/attendance.rds"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">standings</span>, <span class="st">"../data/standings.rds"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">games</span>, <span class="st">"../data/games.rds"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the data set</span></span>
<span><span class="va">attendance</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"../data/attendance.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">standings</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"../data/standings.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">games</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"../data/games.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="q1-is-the-home-field-advantage-real">Q1: Is the home field advantage real?<a class="anchor" aria-label="anchor" href="#q1-is-the-home-field-advantage-real"></a>
</h2>
<p>It is a common saying that the home team has an advantage over the
away team. Is the advantage real?</p>
<p>Figure 1 shows the percentage of games won by home teams. Each row
corresponds to the distribution of weekly percentage of games won by
home teams in a given year. There is a consistent trend that home teams
won more games than away games. Figure 2 shows the percentage of points
gained by the home teams. Though the points depend on other factors such
as competence of the team, home teams typically earn more points, which
further confirms the home field advantage. Figure 3 and 4 show that the
home field advantage is even larger for the Wild Card round, the
Divisional Round, the Conference Championship, and the Super Bowl.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">games</span><span class="op">[</span><span class="st">"is_home_win"</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_int</a></span><span class="op">(</span>.x<span class="op">=</span><span class="va">games</span><span class="op">$</span><span class="va">winner</span>, </span>
<span>                                .y<span class="op">=</span><span class="va">games</span><span class="op">$</span><span class="va">home_team</span>, </span>
<span>                                .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">==</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">games</span><span class="op">[</span><span class="st">"home_pts_percent"</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/pmap.html" class="external-link">pmap_dbl</a></span><span class="op">(</span>.l<span class="op">=</span><span class="va">games</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"is_home_win"</span>, <span class="st">"pts_win"</span>, <span class="st">"pts_loss"</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                                     .f<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">is_home_win</span>, <span class="va">pts_win</span>, <span class="va">pts_loss</span><span class="op">)</span> <span class="op">{</span></span>
<span>                                         <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">is_home_win</span>, <span class="va">pts_win</span>, <span class="va">pts_loss</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">pts_win</span> <span class="op">+</span> <span class="va">pts_loss</span><span class="op">)</span></span>
<span>                                     <span class="op">}</span><span class="op">)</span></span>
<span><span class="va">to_plot</span> <span class="op">=</span> <span class="va">games</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">week</span>, <span class="va">is_home_win</span>, <span class="va">home_pts_percent</span>, <span class="va">home_team_name</span>, <span class="va">away_team_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>team_name<span class="op">=</span><span class="va">home_team_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">standings</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"team_name"</span>, <span class="st">"playoffs"</span><span class="op">)</span><span class="op">]</span>, </span>
<span>               by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">team_name</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>home_playoffs<span class="op">=</span><span class="va">playoffs</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>team_name<span class="op">=</span><span class="va">away_team_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">standings</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"team_name"</span>, <span class="st">"playoffs"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>               by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">team_name</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>away_playoffs<span class="op">=</span><span class="va">playoffs</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">year</span>, <span class="st">"/"</span>, <span class="va">week</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>playoffs<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">home_playoffs</span> <span class="op">==</span> <span class="st">"Playoffs"</span> <span class="op">&amp;</span> <span class="va">away_playoffs</span> <span class="op">==</span> <span class="st">"Playoffs"</span> <span class="op">~</span> <span class="st">"Both Playoffs"</span>,</span>
<span>        <span class="va">home_playoffs</span> <span class="op">==</span> <span class="st">"Playoffs"</span> <span class="op">&amp;</span> <span class="va">away_playoffs</span> <span class="op">==</span> <span class="st">"No Playoffs"</span> <span class="op">~</span> <span class="st">"Home Playoffs"</span>,</span>
<span>        <span class="va">home_playoffs</span> <span class="op">==</span> <span class="st">"No Playoffs"</span> <span class="op">&amp;</span> <span class="va">away_playoffs</span> <span class="op">==</span> <span class="st">"Playoffs"</span> <span class="op">~</span> <span class="st">"Away Playoffs"</span>,</span>
<span>        .default <span class="op">=</span> <span class="st">"None Playoffs"</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">year</span>, <span class="va">week</span>, <span class="va">playoffs</span>, <span class="va">is_home_win</span>, <span class="va">home_pts_percent</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_df</span> <span class="op">=</span> <span class="va">to_plot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">week</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WildCard"</span>, <span class="st">"Division"</span>, <span class="st">"ConfChamp"</span>, <span class="st">"SuperBowl"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">year</span>, <span class="va">week</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>is_home_win_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">is_home_win</span><span class="op">)</span>,</span>
<span>              home_pts_percent_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">home_pts_percent</span><span class="op">)</span>,</span>
<span>              .groups<span class="op">=</span><span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">week</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">plot_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">is_home_win_avg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">year</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"The percentage of wins made by home teams"</span>, </span>
<span>         subtitle <span class="op">=</span> <span class="st">"For each year, the box shows the distribution of the percentage of games won \nby home teams each week"</span>,</span>
<span>         caption <span class="op">=</span> <span class="st">"Data Source: NFL Stadium Attendance (TidyTuesday 2020-02-04)"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"percentage of home wins"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>, hjust <span class="op">=</span> <span class="fl">1</span>, size<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="my_vignette_files/figure-html/Q1%20plot1-1.png" alt="Figure 1: The percentage of wins made by home teams" width="672"><p class="caption">
Figure 1: The percentage of wins made by home teams
</p>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_df</span> <span class="op">=</span> <span class="va">to_plot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">week</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WildCard"</span>, <span class="st">"Division"</span>, <span class="st">"ConfChamp"</span>, <span class="st">"SuperBowl"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">plot_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">home_pts_percent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">year</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"The percentage of points made by home teams"</span>, </span>
<span>         subtitle <span class="op">=</span> <span class="st">"The percentage points made by home teams for each game"</span>,</span>
<span>         caption <span class="op">=</span> <span class="st">"Data Source: NFL Stadium Attendance (TidyTuesday 2020-02-04)"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"percentage of points made by home teams"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>, hjust <span class="op">=</span> <span class="fl">1</span>, size<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="my_vignette_files/figure-html/Q1%20plot%202-1.png" alt="Figure 2: The percentage of points made by home teams" width="672"><p class="caption">
Figure 2: The percentage of points made by home teams
</p>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_df</span> <span class="op">=</span> <span class="va">to_plot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">week</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WildCard"</span>, <span class="st">"Division"</span>, <span class="st">"ConfChamp"</span>, <span class="st">"SuperBowl"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">week</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>is_home_win_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">is_home_win</span><span class="op">)</span>,</span>
<span>              home_pts_percent_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">home_pts_percent</span><span class="op">)</span>,</span>
<span>              .groups<span class="op">=</span><span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">plot_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">is_home_win_avg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">week</span>, scales<span class="op">=</span><span class="st">"fixed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"The percentage of wins by home teams"</span>, </span>
<span>         subtitle <span class="op">=</span> <span class="st">"The mean percentage of winning by home teams for each year's \nWild Card round, Divisional Round, the Conference Championship, and the Super Bowls"</span>,</span>
<span>         caption <span class="op">=</span> <span class="st">"Data Source: NFL Stadium Attendance (TidyTuesday 2020-02-04)"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"percentage of home wins"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>, hjust <span class="op">=</span> <span class="fl">1</span>, size<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="my_vignette_files/figure-html/Q1%20plot%203-1.png" alt="Figure 3: The percentage of wins made by home teams for each year's Wild Card round, Divisional Round, the Conference Championship, and the Super Bowls" width="672"><p class="caption">
Figure 3: The percentage of wins made by home teams for each year’s Wild
Card round, Divisional Round, the Conference Championship, and the Super
Bowls
</p>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">plot_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">home_pts_percent_avg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">week</span>, scales<span class="op">=</span><span class="st">"fixed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"The percentage of points made by home teams"</span>, </span>
<span>         subtitle <span class="op">=</span> <span class="st">"The mean percentage of points made by home teams for each year's \nWild Card round, Divisional Round, the Conference Championship, and the Super Bowls"</span>,</span>
<span>         caption <span class="op">=</span> <span class="st">"Data Source: NFL Stadium Attendance (TidyTuesday 2020-02-04)"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"percentage of points made by home teams"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>, hjust <span class="op">=</span> <span class="fl">1</span>, size<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="my_vignette_files/figure-html/Q1%20plot%204-1.png" alt="Figure 4: The percentage of points made by home teams for each year's Wild Card round, Divisional Round, the Conference Championship, and the Super Bowls" width="672"><p class="caption">
Figure 4: The percentage of points made by home teams for each year’s
Wild Card round, Divisional Round, the Conference Championship, and the
Super Bowls
</p>
</div>
</div>
<div class="section level2">
<h2 id="q2-does-the-number-of-attendants-increase-when-it-is-a-home-game">Q2: Does the number of attendants increase when it is a home
game?<a class="anchor" aria-label="anchor" href="#q2-does-the-number-of-attendants-increase-when-it-is-a-home-game"></a>
</h2>
<p>A home team tends to have more supporters locally. Moreover, due to
the home field advantage, more people might come to witness the winning
of the home team. Thus, it is reasonable to suspect that the number of
attendants for games involving a given team tends to increase when it is
a home game. Indeed, the Figure 5 below supports this argument.</p>
<p>Nevertheless, we can see that the variation in attendance between
home game and away game is large, indicating that many other factors
also influence the attendance. Thus, when building the regression model
in the next section, additional variables that relate to team competence
and opponent quality are included.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">attendance</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">attendance</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">attendance</span><span class="op">$</span><span class="va">weekly_attendance</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">home_games</span> <span class="op">=</span> <span class="va">games</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">week</span>, </span>
<span>           <span class="va">home_team_name</span>, <span class="va">home_team_city</span>, <span class="va">is_home_win</span>, </span>
<span>           <span class="va">away_team_name</span>, <span class="va">away_team_city</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_home <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>is_win <span class="op">=</span> <span class="va">is_home_win</span>, </span>
<span>           team_name <span class="op">=</span> <span class="va">home_team_name</span>, team <span class="op">=</span> <span class="va">home_team_city</span>,</span>
<span>           other_team_name <span class="op">=</span> <span class="va">away_team_name</span>, other_team <span class="op">=</span> <span class="va">away_team_city</span><span class="op">)</span></span>
<span><span class="va">away_games</span> <span class="op">=</span> <span class="va">games</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">week</span>, </span>
<span>           <span class="va">away_team_name</span>, <span class="va">away_team_city</span>, <span class="va">is_home_win</span>, </span>
<span>           <span class="va">home_team_name</span>, <span class="va">home_team_city</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_home <span class="op">=</span> <span class="fl">0</span>, is_home_win <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">is_home_win</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>is_win <span class="op">=</span> <span class="va">is_home_win</span>, </span>
<span>           team_name <span class="op">=</span> <span class="va">away_team_name</span>, team <span class="op">=</span> <span class="va">away_team_city</span>,</span>
<span>           other_team_name <span class="op">=</span> <span class="va">home_team_name</span>, other_team <span class="op">=</span> <span class="va">home_team_city</span><span class="op">)</span></span>
<span><span class="va">is_win_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">home_games</span>, <span class="va">away_games</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">week</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WildCard"</span>, <span class="st">"Division"</span>, <span class="st">"ConfChamp"</span>, <span class="st">"SuperBowl"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">attendance</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"week"</span>, <span class="st">"team_name"</span>, <span class="st">"team"</span>, <span class="st">"weekly_attendance"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>               by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">=</span><span class="st">"year"</span>, <span class="st">"week"</span><span class="op">=</span><span class="st">"week"</span>, <span class="st">"other_team_name"</span><span class="op">=</span><span class="st">"team_name"</span>, <span class="st">"other_team"</span><span class="op">=</span><span class="st">"team"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">standings</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"team"</span>, <span class="st">"team_name"</span>, </span>
<span>                           <span class="st">"margin_of_victory"</span>, <span class="st">"strength_of_schedule"</span>, <span class="st">"playoffs"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>               by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">=</span><span class="st">"year"</span>, <span class="st">"other_team_name"</span><span class="op">=</span><span class="st">"team_name"</span>, <span class="st">"other_team"</span><span class="op">=</span><span class="st">"team"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>playoffs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">playoffs</span><span class="op">==</span><span class="st">"Playoffs"</span> <span class="op">~</span> <span class="fl">1</span>, </span>
<span>        <span class="va">playoffs</span><span class="op">==</span><span class="st">"No Playoffs"</span> <span class="op">~</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>other_weekly_attendance<span class="op">=</span><span class="va">weekly_attendance</span>, </span>
<span>           other_margin_of_victory<span class="op">=</span><span class="va">margin_of_victory</span>,</span>
<span>           other_strength_of_schedule<span class="op">=</span><span class="va">strength_of_schedule</span>,</span>
<span>           other_playoffs<span class="op">=</span><span class="va">playoffs</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">attendance</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"week"</span>, <span class="st">"team_name"</span>, <span class="st">"team"</span>, <span class="st">"weekly_attendance"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>               by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">week</span>, <span class="va">team_name</span>, <span class="va">team</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">standings</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"team"</span>, <span class="st">"team_name"</span>, </span>
<span>                           <span class="st">"margin_of_victory"</span>, <span class="st">"strength_of_schedule"</span>, <span class="st">"playoffs"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>               by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">team_name</span>, <span class="va">team</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>playoffs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">playoffs</span><span class="op">==</span><span class="st">"Playoffs"</span> <span class="op">~</span> <span class="fl">1</span>, </span>
<span>        <span class="va">playoffs</span><span class="op">==</span><span class="st">"No Playoffs"</span> <span class="op">~</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_df</span> <span class="op">=</span> <span class="va">is_win_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">team_name</span>, <span class="va">is_home</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean_weekly_attendance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">weekly_attendance</span><span class="op">)</span>, .groups<span class="op">=</span><span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">is_home</span>, values_from <span class="op">=</span> <span class="va">mean_weekly_attendance</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>weekly_attendance_diff <span class="op">=</span> <span class="va">`1`</span> <span class="op">-</span> <span class="va">`0`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">plot_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">weekly_attendance_diff</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">year</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"The difference in mean weekly attendance between home and away games"</span>, </span>
<span>         subtitle <span class="op">=</span> <span class="st">"The mean increase in attendance for home games compared with\n away games for each team"</span>,</span>
<span>         caption <span class="op">=</span> <span class="st">"Data Source: NFL Stadium Attendance (TidyTuesday 2020-02-04)"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"increase in attendance for home games"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>, hjust <span class="op">=</span> <span class="fl">1</span>, size<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="my_vignette_files/figure-html/unnamed-chunk-2-1.png" alt="Figure 5: The mean increase in attendance for home games compared with away games for each team" width="672"><p class="caption">
Figure 5: The mean increase in attendance for home games compared with
away games for each team
</p>
</div>
</div>
<div class="section level2">
<h2 id="q3-can-we-predict-the-weekly-attendance">Q3: Can we predict the weekly attendance?<a class="anchor" aria-label="anchor" href="#q3-can-we-predict-the-weekly-attendance"></a>
</h2>
<p>The exploratory analysis shows that whether the game is a home game
can partially explain the variance in weekly attendance. To better model
the weekly attendance, information about the opponent quality for each
game as well as the team competence evaluated each year are also
included. The lasso regression is used to predict the weekly attendance.
A 80%/20% train/test split is performed, and the test MSE is used to
evaluate the model.</p>
<p>Sometimes, we might only have access to a subset of the data (main
study). The remaining data may have restricted access and is only
available through its summary statistics fitted on a reduced model
(external study). Since the external study has a large sample size, the
estimated model coefficients tend to be more accurate and have a smaller
variance. Rather than fitting the model only on the main study with a
small sample size, integrating summary statistics from external data
with the main study may elevate the performance of a model. To
illustrate how <code>htlgmm</code> can be used to do the data
integration, the training set is randomly splitted into a main study
(20%) and an external study (80%). The following three models are fitted
and compared.</p>
<ol style="list-style-type: decimal">
<li>Model 1: fit a full model using lasso regression on all training
data.</li>
<li>Model 2: fit a full model using lasso regression only on main
study</li>
<li>Model 3: fit a full model using lasso regression on the main study
while using the summary statistics of a reduced model from the external
study</li>
</ol>
<p>Model 1 results in the lowest test MSE as it has access to all the
data. Compared with model 2 which only uses data in the main study,
model 3 performs better as it borrows additional information from the
external study. This shows that even if the model fitted on the external
study is not the same as the full model used in the main study, we can
still integrate its summary statistics into the model fitted on the main
study.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_df</span> <span class="op">=</span> <span class="va">is_win_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_home_win <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">is_win</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">is_home</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>        <span class="va">is_win</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">is_home</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>        .default <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>playoff_status <span class="op">=</span> <span class="va">playoffs</span> <span class="op">+</span> <span class="va">other_playoffs</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>margin_of_victory_status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">margin_of_victory</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">other_margin_of_victory</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strength_of_schedule_status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">strength_of_schedule</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">other_strength_of_schedule</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">is_home_win</span>, <span class="va">playoff_status</span>, <span class="va">margin_of_victory_status</span>, <span class="va">strength_of_schedule_status</span>,</span>
<span>           <span class="va">margin_of_victory</span>, <span class="va">strength_of_schedule</span>, </span>
<span>           <span class="va">other_margin_of_victory</span>, <span class="va">other_strength_of_schedule</span>, </span>
<span>           <span class="va">weekly_attendance</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">data_df_scaled</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">data_df</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">train_index</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_df_scaled</span><span class="op">)</span>, size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_df_scaled</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">train_df</span> <span class="op">=</span> <span class="va">data_df_scaled</span><span class="op">[</span><span class="va">train_index</span>, <span class="op">]</span></span>
<span><span class="va">test_df</span> <span class="op">=</span> <span class="va">data_df_scaled</span><span class="op">[</span><span class="op">-</span><span class="va">train_index</span>, <span class="op">]</span></span>
<span><span class="va">external_proportion</span> <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="va">external_index</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">train_index</span>, size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">train_index</span><span class="op">)</span><span class="op">*</span> <span class="va">external_proportion</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">train_external_df</span> <span class="op">=</span> <span class="va">data_df_scaled</span><span class="op">[</span><span class="va">external_index</span>, <span class="op">]</span></span>
<span><span class="va">train_main_df</span> <span class="op">=</span> <span class="va">data_df_scaled</span><span class="op">[</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">train_index</span>, <span class="va">external_index</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># transform data into matrices</span></span>
<span><span class="va">train_X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_df</span><span class="op">[</span>, <span class="op">-</span><span class="fl">9</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">train_y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_df</span><span class="op">[</span>, <span class="fl">9</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">train_main_X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_main_df</span><span class="op">[</span>, <span class="op">-</span><span class="fl">9</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">train_main_y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_main_df</span><span class="op">[</span>, <span class="fl">9</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">train_external_X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_external_df</span><span class="op">[</span>, <span class="op">-</span><span class="fl">9</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">train_external_y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_external_df</span><span class="op">[</span>, <span class="fl">9</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">test_X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_df</span><span class="op">[</span>, <span class="op">-</span><span class="fl">9</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Case 1: we have access to all data</span></span>
<span><span class="va">all_lasso</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span><span class="va">train_X</span>, <span class="va">train_y</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">all_pred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">all_lasso</span>, </span>
<span>                             newx <span class="op">=</span> <span class="va">test_X</span>,</span>
<span>                   s <span class="op">=</span> <span class="va">all_lasso</span><span class="op">$</span><span class="va">lambda.min</span><span class="op">)</span></span>
<span><span class="va">all_mse</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">all_pred</span> <span class="op">-</span> <span class="va">test_df</span><span class="op">$</span><span class="va">weekly_attendance</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Case 2: we have only a small sample of data</span></span>
<span><span class="va">internal_only_lasso</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span><span class="va">train_main_X</span>, <span class="va">train_main_y</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">internal_only_pred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">internal_only_lasso</span>, </span>
<span>                             newx <span class="op">=</span> <span class="va">test_X</span>, s <span class="op">=</span> <span class="va">internal_only_lasso</span><span class="op">$</span><span class="va">lambda.min</span><span class="op">)</span></span>
<span><span class="va">internal_only_mse</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">internal_only_pred</span> <span class="op">-</span> <span class="va">test_df</span><span class="op">$</span><span class="va">weekly_attendance</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Case 3: an external model is provided</span></span>
<span><span class="va">external_lm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">weekly_attendance</span><span class="op">~</span><span class="va">.</span>, data<span class="op">=</span><span class="va">train_external_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"margin_of_victory"</span>,</span>
<span>                                                               <span class="st">"strength_of_schedule"</span>,</span>
<span>                                                             <span class="st">"weekly_attendance"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">study_info</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">study_external</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    Coeff<span class="op">=</span><span class="va">external_lm</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    Covariance<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">external_lm</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    Sample_size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">train_external_df</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">study_info</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">study_external</span></span>
<span><span class="va">Y</span> <span class="op">=</span> <span class="va">train_main_y</span></span>
<span><span class="va">Z</span> <span class="op">=</span> <span class="va">train_main_X</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"margin_of_victory"</span>,<span class="st">"strength_of_schedule"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">W</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">train_main_X</span>, </span>
<span>           select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">train_main_X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> </span>
<span>                               <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"margin_of_victory"</span>,<span class="st">"strength_of_schedule"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res_htlgmm.cv</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/cv.htlgmm.html">cv.htlgmm</a></span><span class="op">(</span>y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>,</span>
<span>                   Z<span class="op">=</span><span class="va">Z</span>,</span>
<span>                   W<span class="op">=</span><span class="va">W</span>,</span>
<span>                   A<span class="op">=</span><span class="fl">1</span>,</span>
<span>                   study_info <span class="op">=</span> <span class="va">study_info</span>,</span>
<span>                   family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                   penalty_type <span class="op">=</span> <span class="st">"lasso"</span>,</span>
<span>                   use_sparseC <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                   inference<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                   nfold<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">res_htlgmm</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/htlgmm.html">htlgmm</a></span><span class="op">(</span>y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>,</span>
<span>                   Z<span class="op">=</span><span class="va">Z</span>,</span>
<span>                   W<span class="op">=</span><span class="va">W</span>,</span>
<span>                   A<span class="op">=</span><span class="fl">1</span>,</span>
<span>                   study_info <span class="op">=</span> <span class="va">study_info</span>,</span>
<span>                   family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                   penalty_type <span class="op">=</span> <span class="st">"lasso"</span>,</span>
<span>                   use_sparseC <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                   inference<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                   fix_lambda <span class="op">=</span> <span class="va">res_htlgmm.cv</span><span class="op">$</span><span class="va">lambda_min</span><span class="op">)</span></span>
<span><span class="va">htlgmm_cv_pred</span> <span class="op">=</span> <span class="va">test_X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">res_htlgmm</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">8</span>, <span class="fl">9</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="va">res_htlgmm</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">htlgmm_mse</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">htlgmm_cv_pred</span> <span class="op">-</span> <span class="va">test_df</span><span class="op">$</span><span class="va">weekly_attendance</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># display the results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"MSE for model 1 (all):       %.4f\nMSE for model 2 (main only): %.4f\nMSE for model 3 (htlgmm):    %.4f"</span>, <span class="va">all_mse</span>, <span class="va">internal_only_mse</span>, <span class="va">htlgmm_mse</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; MSE for model 1 (all):       0.9770</span></span>
<span><span class="co">#&gt; MSE for model 2 (main only): 0.9809</span></span>
<span><span class="co">#&gt; MSE for model 3 (htlgmm):    0.9786</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>The analysis aims to investigate factors affecting the weekly
attendance of NFL games and build a lasso regression model to predict
the weekly attendance. The exploratory analysis shows that the home
field advantage exists, and a game at the home city tends to have a
higher attendance. This city information, as well as information on the
opponent quality and team’s yearly competence ratings, are used to
predict the weekly attendance. The test MSE on the scaled data is 0.977.
Moreover, we explored the scenario when we only have access to the
summary statistics from an external study with a large sample size and
the individual level data from a main study with a small sample size.
When the data integration method in <code>htglmm</code> is used to
integrate the summary statistics with the main study, the test MSE
decreases, which illustrates the effectiveness of the integration
method.</p>
</div>
<div class="section level2">
<h2 id="functions-used-in-the-analysis">Functions used in the analysis<a class="anchor" aria-label="anchor" href="#functions-used-in-the-analysis"></a>
</h2>
<ul>
<li>
<code>purrr</code> package: <code>map2_int</code>,
<code>pmap_dbl</code>
</li>
<li>
<code>dypyr</code> package: <code>select</code>,
<code>mutate</code>, <code>rename</code>, <code>inner_join</code>,
<code>case_when</code>, <code>group_by</code>, <code>summarize</code>,
<code>filter</code>, <code>arrange</code>
</li>
<li>
<code>ggplot2</code> package: <code>geom_boxplot</code>,
<code>geom_line</code>, <code>geom_point</code>,
<code>facet_wrap</code>
</li>
<li>
<code>htlgmm</code> package: <code>htlgmm</code>,
<code>htlgmm.cv</code>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Ruzhang Zhao.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
